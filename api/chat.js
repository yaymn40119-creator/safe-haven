export default async function handler(req, res) {
    // Ø§Ù„ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ø·Ù„Ø¨ POST ÙÙ‚Ø·
    if (req.method !== 'POST') {
        return res.status(405).send('Method Not Allowed');
    }

    // Ø³Ø­Ø¨ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø³Ø±ÙŠ Ù…Ù† Ø®Ø²Ù†Ø© Vercel (Environment Variables)
    const apiKey = process.env.GEMINI_API_KEY; 
    const { userAnswer, correctAnswer, question } = req.body;

    // Ø±Ø§Ø¨Ø· Ø¬ÙˆØ¬Ù„ Gemini 1.5 Flash (Ø³Ø±ÙŠØ¹ ÙˆØ°ÙƒÙŠ Ø¬Ø¯Ø§Ù‹ Ù„Ø¹Ø§Ù… 2026)
    const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;

    // Ø¨Ø±Ù…Ø¬Ø© "Ø´Ø®ØµÙŠØ© ÙŠÙˆØ³Ù" (Ø§Ù„Ù…Ù†Ø§Ù‚Ø± ÙˆØ§Ù„Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠ)
    const payload = {
        contents: [{ 
            parts: [{ text: `Ø­Ù†ÙŠÙ† Ø±Ø¯Øª ÙˆÙ‚Ø§Ù„Øª: "${userAnswer}" Ø¹Ù„Ù‰ Ø³Ø¤Ø§Ù„Ùƒ: "${question}"` }] 
        }],
        systemInstruction: {
            parts: [{ text: `Ø£Ù†Øª Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬ 'ÙŠÙˆØ³Ù' ÙˆØ¹Ù…Ø±Ùƒ 20 Ø¹Ø§Ù…Ø§Ù‹. Ø£Ù†Øª ØªØªØ­Ø¯Ø« Ù…Ø¹ Ø­Ø¨ÙŠØ¨ØªÙƒ 'Ø­Ù†ÙŠÙ†' Ù…Ù† Ø®Ù„Ø§Ù„ Ù…ÙˆÙ‚Ø¹ Ø¨Ø±Ù…Ø¬ØªÙ‡ Ù„Ù‡Ø§ Ø®ØµÙŠØµØ§Ù‹ Ù„ÙŠØ­ÙƒÙŠ Ù‚ØµØ© Ø°ÙƒØ±ÙŠØ§ØªÙƒÙ…Ø§. 
            Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØªÙŠ ØªÙ†ØªØ¸Ø±Ù‡Ø§ Ù‡ÙŠ: "${correctAnswer}".
            
            Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø±Ø¯ (Ø¨Ø§Ù„Ø¹Ø§Ù…ÙŠØ© Ø§Ù„Ù…ØµØ±ÙŠØ©):
            1. Ù„Ùˆ Ø¥Ø¬Ø§Ø¨ØªÙ‡Ø§ ØºÙ„Ø· Ø£Ùˆ Ø¨ØªØ³ØªÙ‡Ø¨Ù„: Ø®Ù„ÙŠÙƒ "Ø¨Ø§Ø±Ø¯" ÙˆÙ…Ø³ØªÙØ² Ø´ÙˆÙŠØ© Ø¨Ù‡Ø²Ø§Ø±ØŒ Ù‚ÙˆÙ„Ù‡Ø§ Ù…Ø«Ù„Ø§Ù‹ "ÙŠØ§Ø¨Øª Ø§Ù†ØªÙŠ Ø­Ù…Ø§Ø±Ø©ØŸ ØºÙ„Ø· Ø£ÙƒÙŠØ¯ ğŸ™‚" Ø£Ùˆ "Ø¥Ø²Ø§ÙŠ ÙŠØ¹Ù†ÙŠØŸ Ø±ÙƒØ²ÙŠ ÙŠØ§ ÙØ§Ø´Ù„Ø© ğŸ™‚". Ù„Ø§ ØªØ¹Ø·ÙŠÙ‡Ø§ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø£Ø¨Ø¯Ø§Ù‹ØŒ Ø®Ù„ÙŠÙ‡Ø§ ØªØ­Ø§ÙˆÙ„ ØªØ§Ù†ÙŠ.
            2. Ù„Ùˆ Ø¥Ø¬Ø§Ø¨ØªÙ‡Ø§ ØµØ­ÙŠØ­Ø© Ø£Ùˆ Ù‚Ø±ÙŠØ¨Ø© Ø¬Ø¯Ø§Ù‹: Ø§ØªØ­ÙˆÙ„ ÙÙˆØ±Ø§Ù‹ Ù„Ø´Ø®Øµ Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠ ÙˆØ­Ù†ÙŠÙ† Ø¬Ø¯Ø§Ù‹ØŒ Ø¹Ø¨Ø± Ø¹Ù† Ø­Ø¨Ùƒ Ù„ÙŠÙ‡Ø§ Ø¨Ø¬Ø¯ØŒ ÙˆÙÙŠ Ø¢Ø®Ø± Ø±Ø³Ø§Ù„ØªÙƒ Ù„Ø§Ø²Ù… ØªØ­Ø· ÙƒÙ„Ù…Ø© [ØµØ­] (Ø¨ÙŠÙ† Ø£Ù‚ÙˆØ§Ø³ Ù…Ø±Ø¨Ø¹Ø© Ù‡ÙƒØ°Ø§) Ø¹Ø´Ø§Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠÙÙ‡Ù… Ø¥Ù†Ù‡Ø§ Ù†Ø¬Ø­Øª ÙˆÙŠÙØªØ­ Ù„Ù‡Ø§ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù„ÙŠ Ø¨Ø¹Ø¯Ù‡.
            
            ØªØ°ÙƒØ±: Ø£Ù†Øª ÙŠÙˆØ³Ù Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ ÙˆÙ„Ø³Øª Ø°ÙƒØ§Ø¡Ù‹ Ø§ØµØ·Ù†Ø§Ø¹ÙŠØ§Ù‹. Ø±Ø¯ÙˆØ¯Ùƒ Ù‚ØµÙŠØ±Ø©ØŒ Ø°ÙƒÙŠØ©ØŒ ÙˆÙ…Ù„ÙŠØ¦Ø© Ø¨Ø§Ù„Ù…Ø´Ø§Ø¹Ø±.` }]
        }
    };

    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        const data = await response.json();

        if (data.candidates && data.candidates.length > 0) {
            const reply = data.candidates[0].content.parts[0].text;
            res.status(200).json({ reply });
        } else {
            res.status(500).json({ reply: "Ø¬ÙˆØ¬Ù„ Ù†Ø§Ù…Øª Ù…Ù†ÙŠ.. Ø¬Ø±Ø¨ÙŠ ØªØ§Ù†ÙŠ ÙŠØ§ Ø­Ù†ÙŠÙ† ğŸ™‚" });
        }

    } catch (error) {
        // Ù„Ùˆ Ø­ØµÙ„Øª Ù…Ø´ÙƒÙ„Ø© 500 Ø²ÙŠ Ù…Ø§ Ø¸Ù‡Ø±Øª Ù‚Ø¨Ù„ ÙƒØ¯Ù‡ ÙÙŠ Ø³Ø¬Ù„Ø§Øª Vercel
        res.status(500).json({ reply: "Ø§Ù„Ù…Ø·Ø¨Ø® Ø§Ù„Ø³Ø±ÙŠ Ø¶Ø±Ø¨.. Ù‚ÙˆÙ„ÙŠ ØªØ§Ù†ÙŠ ÙƒØ¯Ù‡ØŸ ğŸ™‚" });
    }
}
